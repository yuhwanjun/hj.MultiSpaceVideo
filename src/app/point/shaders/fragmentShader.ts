/**
 * Point Cloud Fragment Shader
 * 
 * 포인트 클라우드의 최종 색상과 투명도를 결정하는 프래그먼트 셰이더입니다.
 * 
 * 주요 기능:
 * 1. 슬라이스 마스킹 적용 - vMask가 0이면 discard
 * 2. 색상 출력 - vertex shader에서 전달받은 색상 사용
 * 3. 불투명도 적용 - uOpacity uniform으로 투명도 조절
 */

/**
 * Fragment Shader 소스 코드
 * 
 * Uniforms:
 * - uOpacity: 포인트 불투명도 (0.0 ~ 1.0)
 * 
 * Varyings (from Vertex Shader):
 * - vColor: 포인트 RGB 색상
 * - vMask: 슬라이스 마스크 (0: 숨김, 1: 표시)
 */
export const fragmentShader = `
  precision mediump float;
  
  // ============================================================================
  // Varyings - Vertex Shader에서 전달받은 값
  // ============================================================================
  varying vec3 vColor;   // 포인트 색상 (RGB, 0~1 범위)
  varying float vMask;   // 슬라이스 마스크 값
  
  // ============================================================================
  // Uniforms - 전역 설정값
  // ============================================================================
  uniform float uOpacity; // 포인트 불투명도
  
  // ============================================================================
  // Main Fragment Shader
  // ============================================================================
  void main() {
    // ------------------------------------------------------------------------
    // 1. 슬라이스 마스킹 체크
    // ------------------------------------------------------------------------
    // vMask가 0.5 미만이면 이 프래그먼트를 렌더링하지 않음
    // 이를 통해 XYZ 슬라이스 범위 밖의 포인트를 숨김
    if (vMask < 0.5) discard;
    
    // ------------------------------------------------------------------------
    // 2. 최종 색상 출력
    // ------------------------------------------------------------------------
    // RGB는 vertex shader에서 텍스처로부터 읽은 값
    // Alpha는 uniform으로 전달받은 불투명도 값
    gl_FragColor = vec4(vColor, uOpacity);
  }
`;

export default fragmentShader;


